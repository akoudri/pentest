from scapy.all import *
from scapy.layers.inet import IP, TCP

# Define the target
target = "127.0.0.1"

# Create an IP packet with the target subnet as the destination
ip_packet = IP(dst=target)

# Create a TCP packet with the SYN flag set
tcp_packet = TCP(dport=range(1, 1024), flags="S")

# Combine the IP and TCP packets
packet = ip_packet / tcp_packet

# Send the packets and capture the responses
answered, unanswered = sr(packet, timeout=2, verbose=0)

# Print the results
for sent, received in answered:
    if received.haslayer(TCP) and received.getlayer(TCP).flags == 0x12:
        print(f"Port {sent[TCP].dport} is open on {received[IP].src}")