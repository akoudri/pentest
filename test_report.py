from docx import Document
from docx.shared import Inches
from jinja2 import Template
import plotly.graph_objects as go
import io


# Fonction pour créer un graphique Plotly
def create_plotly_chart():
    x = [1, 2, 3, 4]
    y = [10, 15, 13, 17]
    fig = go.Figure(data=go.Scatter(x=x, y=y, mode='lines+markers'))
    fig.update_layout(title='Exemple de Graphique', xaxis_title='X Axis', yaxis_title='Y Axis')

    # Sauvegarder le graphique en tant qu'image
    img_bytes = fig.to_image(format="png")
    return io.BytesIO(img_bytes)


# Créer un template Jinja2
template_string = """
# {{ title }}

{{ content }}

[Graphique sera inséré ici]

Rapport généré le {{ date }}
"""

# Préparer les données pour le template
data = {
    'title': 'Rapport avec Graphique',
    'content': 'Voici un exemple de rapport généré avec python-docx, Jinja2 et Plotly.',
    'date': '2024-10-07'
}

# Rendre le template
template = Template(template_string)
content = template.render(data)

# Créer le document Word
doc = Document()

# Ajouter le contenu rendu par Jinja2
for line in content.split('\n'):
    if line.startswith('#'):
        doc.add_heading(line[1:].strip(), level=1)
    elif line == '[Graphique sera inséré ici]':
        # Insérer le graphique Plotly
        doc.add_picture(create_plotly_chart(), width=Inches(6))
    elif line:
        doc.add_paragraph(line)

# Sauvegarder le document
doc.save('rapport.docx')

print("Rapport généré avec succès : rapport.docx")