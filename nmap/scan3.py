"""
On importe le module nmap.
On spécifie la cible à scanner, ici une adresse IP.
On initialise un objet PortScanner de nmap.
On configure les options du scan :
-sU pour effectuer un scan UDP
-p- pour scanner tous les ports
--top-ports 100 pour ne scanner que les 100 ports UDP les plus courants
--open pour ne montrer que les ports ouverts dans le résultat
-T4 pour aller vite (diminue la discrétion mais augmente la vitesse)
--host-timeout 5s pour définir un timeout de 5 secondes par hôte
On lance le scan avec ces options sur la cible spécifiée.
On affiche des informations générales sur l'hôte comme son état (up, down).
On itère sur les protocoles détectés (dans ce cas seulement udp).
Pour chaque protocole, on récupère les ports ouverts.
Pour chaque port ouvert, on affiche son numéro et son état.
Ce script effectue donc un scan UDP sur les 100 ports UDP les plus courants de la cible spécifiée, avec un timeout de 5 secondes.
Il affiche ensuite les informations sur les ports UDP ouverts détectés.
Notez que les scans UDP peuvent être lents car contrairement à TCP, UDP ne prévoit pas de mécanisme de "handshake".
Donc en l'absence de réponse, nmap attend le timeout pour considérer le port comme filtré.
C'est pourquoi un timeout assez court est spécifié ici.
"""

import nmap

# Spécifier la cible
target = '192.168.1.1'

# Initialiser le scanner
nm = nmap.PortScanner()

# Spécifier les options du scan
# -sU : UDP scan
# -p- : scanner tous les ports
# --top-ports 100 : scanner les 100 ports les plus courants
# --open : ne montrer que les ports ouverts
# -T4 : aller vite
# --host-timeout 5s : timeout de 5 secondes par hôte
nm.scan(target, arguments='-sU -p- --top-ports 100 --open -T4 --host-timeout 5s')

# Afficher les informations sur l'hôte
print(f"Host : {target}")
print(f"State : {nm[target].state()}")

# Afficher les ports ouverts
for proto in nm[target].all_protocols():
    print(f"Protocol : {proto}")

    lport = nm[target][proto].keys()

    for port in lport:
        print(f"port : {port}\tstate : {nm[target][proto][port]['state']}")